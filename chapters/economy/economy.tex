\chapter{The Economy of Things}
\label{sec:economy}

Smart objects are able to compute, to communicate and to sense and act on the physical world. Thus, they represent the building blocks of pervasive systems and the Internet of Things \cite{kortuem2010smart}. But being smart is not enough. Although the importance of interoperability has been highlighted by scholars \cite{zorzi2010} and practitioners \cite{manyika2015unlocking}, most connected devices operate in application-specific silos and communicate not with each other, but solely with the manufacturer's backend services or directly with people via smart phone apps.
Obstacles on the road to interoperability and \textit{the} Internet of Things are not only technical, e.g. heterogeneity (and thus complexity) and security, but also the lock-in business model of companies.
Cryptocurrencies and blockchain technology with their prime representative Bitcoin provide a new design space to tackle these issues by providing smart objects with unprecedented economic capabilities and autonomy from central coordination. This economic empowerment of connected devices is particularly well suited for the emergent paradigms of (autonomous) fog computing \cite{Bonomi:2012:FCR:2342509.2342513} and the web of things . Smart objects can get the ability to offer services for payments, pay other smart object autonomously, and even generate cryptocurrency to stay liquid. Moreover, smart objects that \textit{live on a blockchain} can be managed, shared, sold and rented without the need of backend infrastructure provided by the manufacturer. Furthermore new types of ownership and monetization models are conceivable.


\section{Building Blocks}

\subsection{Identity or Representation on the Blockchain}

Economic objects can have various representations on a blockchain depending on the capabilities of the object and the specifics of the blockchain. A basic requirement for an economic object is to be able to receive and to send cryptocurrency. Thus, an economic object needs at least an \emph{account} on the respective blockchain.

However, representation of ownership 

\subsection{Interaction with the Blockchain}

Smart objects vary significantly in their capabilities. From tiny battery-powered sensors with restricted computation and communication capabilities to smart TVs and refrigerators that are constantly connected to broadband internet and continuous power supply. How will these objects interact with the blockchain? How do they initiate and verify transactions? 

\subsection{Micropayments}

\section{Economic Objects on Bitcoin}

\section{Instant Micropayments}

Most services that economic objects could provide are low value services relative to our day to day experience as humans. Hence, there is a need for efficient, low-friction micropayments. 

PayPal considers payments below \$10 as micropayments\footnote{https://www.paypal.com/us/webapps/mpp/merchant-fees}, and the fees for micropayments are 5\% + \$0.05 in June 2016. Hence, for payments below \$1 the fees are at least 10\%, and payments on the order of cents are not viable. 

In case of Bitcoin, and most other cryptocurrencies, transaction fees can be specified by the creator of a transaction, and miners can individually decide if they are willing to include the respective transaction into a block. Hence, although it is still possible to create zero fee transactions in Bitcoin, most miners expect a non-zero fee. Since blocks currently have maximal size of 1 Megabyte, block space can be considered a scare resource. This effectively leads to a size-based, instead of the common value-based, market price for a transaction. By tracking for how many blocks a transaction of a particular size and a particular fee resides in the mempool until the transaction is included into a block, the minimal fee for a given priority requirement can be determined. Wallets can either do this on their own or rely on web services such as bitcoinfees.21.co. 
Currently, a transaction with a high chance to be included in the next block has to include a fee of approximately 60 satoshis per byte. A typical P2PKH transaction with one input and two outputs, one for the payment and one for change, has a size of approximately 250 bytes. Hence, the fee is around 15,000 satoshis, and thus almost \$0.1 at the current exchange rate of \$650 per BTC. 
Normal P2PKH transactions are thus not suitable for micropayments. Another obstacle for naive micropayments in Bitcoin is the UTXO-based architecture. UTXOs with values on the order of satoshis would lead to a drastic increase of the UTXO set, and therefore on the resource requirements of network nodes. Furthermore, spending a macroscopic amount by combining hundreds or thousands of microscopic UTXOs would lead to very large and expensive transactions. 

In addition, confirmation times on the order of tens of minutes are too long for many types of  machine-to-machine transactions.

\subsection{Off-Chain Micropayments}

Centralized third party services have been emerged that allow zero fee microtransactions between their users. Examples are Coinbase\footnote{https://www.coinbase.com}, 21\footnote{https://www.21.co}, and ChangeTip\footnote{https://www.changetip.com}. Thereby users deposit coins in addresses controlled by the third party service. The service then handles transactions between users internally, i.e. off-chain. However, users lose all control over their funds. The situation looks similar to using PayPal. Why does PayPal charge fees but services based on Bitcoin do not? The main reasons are: (1) PayPal accounts are usually funded by credit cards, and those transactions are susceptible to chargeback fraud. (2) Regulatory overhead. 

\subsection{Payment Channels}

\subsubsection{Unidirectional Payment Channels}
\label{sec:unipc}

The idea to use Bitcoin contracts to establish payment channels between two parties was introduced by Hearn and Spilman \cite{Hearn}. An unidirectional payment channel allows a single payer to pay a single payee repeatedly by sending signed transactions over some communication channel. Individual payments can be as low as 1 satoshi and the payee is able to accept payments instantly without double-spending risk. This is achieved by using the blockchain as a trustless escrow service in form of a timelocked multisignature output that is funded by the payer. A graphical representation and a description of a non-interactive implementation of the protocol is depicted in Figure \ref{fig:paymentchannels}.

\begin{figure}
\includegraphics[scale=.7]{./externalized/paymentchannel.pdf}
\caption{An unidirectional payment channel between a payer A and a payee B. To open a channel A creates and broadcasts a funding transaction with an output that can be spent only by providing signatures from both parties, i.e. $\sigma(A)$ and $\sigma(B)$ (multisignature). The value of this output is then shared between A and B in off-chain payment transactions. A creates and (partially) signs those payment transactions, and sends them to B via some private or public communication channel. While A has only partially signed payment transactions, B is able sign and broadcast any of those transactions to close the channel. If B is rational he will always broadcast the transaction that allocates the largest share to him. Therefore A can not decrease B's share in a subsequent payment transaction, and the payment channel is thus unidirectional. If B does not broadcast a payment transactions before $T_1$, A is able to recover the funds by broadcasting a refund transaction.}
\label{fig:paymentchannels}
\end{figure}

Unidirectional payment channels between two parties involve two on-chain Bitcoin transactions. One funding transaction and one transaction to close the channel. In the unidirectional setting only one party funds the channel and risks locking her funds (temporarily) in case the receiving party is not cooperative. Simple unidirectional payment channels are useful for repeated, metered payments between a single payer and a single payee. Use cases are video streaming\footnote{https://streamium.io/}, WiFi access \cite{Siby2013}.

\subsubsection{Bidirectional Payment Channels}

In the payment channel design presented in Sec. \ref{sec:unipc} it is not possible to revert a payment, because of the inherent asymmetry of the design. The initial payee is able to broadcast \emph{any} of the subsequent payment transactions, and will thus always broadcast the one with the greatest share allocated to him, and not necessarily the latest, if the payer would try to revert a payment. 

There are two designs that allow bidirectional payment channels: (1) Replace by timelock, and (2) Revocable commitment transactions.


The replace by timelock mechanism works by attaching decreasing absolute timelocks to each payment transaction. In contrast to the unidirectional payment channels presented in Sec. \ref{sec:unipc}, in the bidirectional payment channel scenario both parties hold fully-signed, broadcast-ready payment transactions. The decreasing absolute timelock ensures that the latest transaction would always end up in the blockchain first. Since every payment decreases the lifetime of the channel the simple design is not very practical. However, duplex micropayment channels are advancing this mechanism by providing trustless cooperative protocols to reset, i.e. balancing values, and refresh channels, i.e. increasing the timelock. 

Bidirectional payment channels based on revocable commitment transactions work as follows:
Assuming two parties, A and B, the protocol begins with the creation of a transaction that attempts to create a shared multisignature output that is funded by both parties. However, before broadcasting this \emph{funding} transaction, which is not timelocked, both parties create \emph{commitment} transactions. Both commitment transactions attempt to spend the multisignature output of the funding transaction, and create an output with the pubScript depicted in Fig. \ref{fig:pubScriptCommitment}.

\begin{figure}
\begin{lstlisting}[breaklines,mathescape=true]
OP_IF
	OP_DUP OP_HASH160 <PubKeyHash B (A)> OP_EQUALVERIFY OP_CHECKSIG
	HASH160 <Hash160 (revocation secret)> EQUAL
OP_ELSE
	OP_DUP OP_HASH160 <PubKeyHash A (B)> OP_EQUALVERIFY OP_CHECKSIG
	<$\Delta$> CHECKSEQUENCEVERIFY DROP
OP_ENDIF
\end{lstlisting} 
\caption{PubScript of commitment transactions of A (B) for a bidirectional payment channel. The output can either be spent immediately by the counterparty if the counterparty can provide the revocation secret, or by the originator after a relative timelock $\Delta$.}
\label{fig:pubScriptCommitment}
\end{figure}

After the commitment transactions have been exchanged, the funding transaction can be broadcasted. 

\subsubsection{Mediated Payment Channels}

Mediated payment channels allow the routing of payments through intermediate payment channels by using a concept called \emph{hashlocks}. Assume Alice (A) wants to send a small payment to Bob (B), but Alice and Bob do not have an open payment channel. However, A has a channel with Charlie (C), and C has a channel with B. In principle A could pay C and tell him to pay B. But A has no way to enforce the payment from B to C if the payment channels are independent. We need a way to condition the individual payments on each other. This can be done by conditioning the payments on a common secret generated by the final recipient B.

\subsubsection{Payment Channel Networks}
\label{sec:paymentchannelnetworks}

Payment channel networks are the generalization of mediated bidirectional payment channels. In principle they allow to interconnect an arbitrary number of payment channels in order to route instant off-chain payments. 


\section{Economic Objects on Ethereum}
\section{Case Studies}

\subsection{Filament}

Filament (2015) provides wireless sensor networks for the (industrial) IoT, e.g. for smart cities or smart agriculture use case. Most IoT platform providers follow a centralized approach by connecting all devices to their respective cloud-infrastructure. This has the major disadvantage that devices de- pend on a central infrastructure in order to operate. Moreover, it can be argued that this approach can- not keep up technically and economically with the increasing number connected devices.
Filament is one of the first companies that develop a fully decentralized IoT infrastructure, which en- compasses three blockchain-related aspects: (1) Each device is registered on the blockchain providing a verifiable and immutable identity. This enables discovering of and authenticating with other devic- es/services without the need of a dedicated backend infrastructure. Therefore, devices are technically autonomous and are able to operate independently of Filament. (2) Each device is governed by a “smart” contract, which manages agreements of device control/ownership, data access and financial agreements concerning the device. Ownership can be transferred permanently or temporarily by a simple transaction on the blockchain. Filament implements the financial agreements as a Product-as-a- Service, which means that the owner gets paid directly for the ongoing use of the device. (3) Further- more, each device is able to transfer value in form of bitcoins to other devices in order to get access to data or request some service.
As described, devices can be operated and governed by using only the blockchain as a backend and therefore without any technical dependence on the platform creator (Filament) or other third parties. This might bare great benefits for customers needing to deploy large Industrial IoT applications with a lifetime of 5-10 years. Because they want to minimize the risk of a lock-in with a specific company. Moreover, according to Filament, customers prefer paying continuously on a real-time basis instead of an upfront investment, which can be solved efficiently by Bitcoin micropayments. Ownership is de- coupled from usage and both are independent of the manufacturer or a platform provider.
Filament itself is a venture capital-backed company formerly known as Pinocc.io. They claim to have their first deployments with Fortune 500 companies in 2016. They will get paid for the ongoing use of their devices (by owning the smart contract). Moreover, they work on a licensing model, i.e. Custom- ers can attach a module version to their own devices, which will give them all the described benefits of

\subsection{21 Inc}

\subsubsection{Portrait}
21 Inc was founded May 2013, but remained stealth until May 2015. In June 2016 the company has a total funding of USD 121.05M. Thereby being the most funded start up in the Bitcoin ecosystem. Their first product, the 21 Bitcoin Computer, was released in November 2015. In March 2016 a micropayment marketplace was opened, and in June 2016, the 21 software library which allows to build bitcoin-payable Representational State Transfer (REST) APIs, UNIX commandline tools, and access to the 21 marketplace became available on other UNIX-based platforms, free and open source under the free BSD license.

21 aims to make Bitcoin a standard resource for UNIX-based systems and provide the tools and services for developers to build a \emph{machine-payable web} where individual machines can cooperate globally, and potentially autonomously, in exchange for bitcoin micropayments.

\subsubsection{Technological Overview}

In the following we present the core technology stack provided by 21. Figure \ref{fig:21stack} illustrates the stack together with additional services that distinguish 21.

\begin{figure}
\centering
\includegraphics[scale=0.7]{./externalized/21stack.pdf}
\caption{The 21 technology stack and accompanying services.}
\label{fig:21stack}
\end{figure}

\paragraph{Embedded Mining Chip}

The 21 BC has an embedded mining chip with a hashing rate of approx. 50 GH/s and an energy efficiency of 0.16 J/GH. The chip contributes its hashing rate to a currently centralized mining pool orchestrated by 21. So far the chip is only deployed in 21 BCs and in data centers operated by 21. 	

In comparison, the total hashing rate of the Bitcoin network is around 1,500,000,000 GH/s in Q2 2016. 

\paragraph{Machine Wallet}

The 21 machine wallet is a hierarchical deterministic key Bitcoin wallet that can be interfaced either via command line or, more importantly, programmatically. The machine wallet provides access to on-chain funds and off-chain (BitTransfers)funds, and is the basis for interacting with bitcoin-payable APIs. 

BitTransfers are initiated by sending a serialized JSON document to a 21 server. The JSON document is authenticated by a signature corresponding to the wallets main key. 

\begin{figure}
\label{lst:21bittransfer}
\begin{lstlisting}[breaklines]
        bittransfer = json.dumps({
            'payer': self.username,
            'payer_pubkey': compressed_pubkey,
            'payee_address': payee_address,
            'payee_username': payee_username,
            'amount': price,
            'timestamp': time.time(),
            'description': response.url
        })      
        signature = self.wallet.sign_message(bittransfer)
        return {
            'Bitcoin-Transfer': bittransfer,
            'Authorization': signature
        }
\end{lstlisting}
\caption{Authenticated data structure to initiate a BitTransfer%\footnote{c.f. https://github.com/21dotco/two1-python/blob/master/two1/bitrequests/bitrequests.py.
}
\end{figure}


\paragraph{Developer Tools}

The 21 library is a collection of libraries that support a developer to build bitcoin-payable services. The most important parts are libraries to serve and consume/pay REST APIs using on-chain payments, payment channels and BitTransfers. Furthermore, there are libraries to work with various Bitcoin-related primitives.  


\paragraph{Software Defined Networking}

Most machines in the Internet are behind routers that employ network address translation (NAT) and/or disallow incoming connections from machines in other networks. Furthermore, Internet Service Providers (ISPs) often reassign IP addresses on reconnects. Hence, p2p communication and trading between personal machines is inherently hard given the predominant Internet architecture. 21 solves this problem with software defined networking (SDN). In particular, the SDN technology of ZeroTier\footnote{https://www.zerotier.com} is used. SDN allows to virtualize networks such that machines living in different physical networks connected via TCP/IP can communicate with each other as if they were in a single local area network. This entails that all traffic is encrypted and authenticated. 

\paragraph{Marketplace}

The marketplace allows sellers to publish bitcoin-payable APIs, and allows potential buyers to query and discover bitcoin-payable APIs. Although the marketplace is centrally hosted, trades are peer-to-peer. The marketplace is the first marketplace for digital goods and (micro) services. At time of writing the marketplace is small and most services are directly provided by 21. Fig. \ref{fig:21marketplace} shows the number of APIs offered by each individual seller. In July 2016, there are 86 APIs offered. 49 are provided by 21. Independent sellers mostly provide one single API. Table \ref{tbl:21marketplace} gives an overview of the top five services. All of them are offered by 21. 

In order to interact with the marketplace a user has to open an account with 21. However, only an username and password are required. Social connections such as Twitter, LinkedIn or GitHub can be provided. Analogous to existing marketplaces like Amazon and eBay, buyers are able to publicly rate sellers after purchase.  

\begin{figure}
\centering
\includegraphics[scale=0.7]{./externalized/21marketplace_creators.pdf}
\caption{Number of APIs in the 21 marketplace by individual vendors. The first vendor is 21 itself.}
\label{fig:21marketplace}
\end{figure}


\begin{table}
\centering
\begin{tabular}{lr}
    \toprule
    Name & Price [Satoshis] \\
    \midrule
    Zip Code Data & 2500 \\
    Ping21 Aggregator & 3000 \\
    Part of Speech Tagger & 6000 \\
    Twitter Influence Ranking & 5000 \\
    Neural Art & Variable \\
    \bottomrule
    \label{tbl:21marketplace}
  \end{tabular}
  \caption{The five most popular APIs. All are created by 21.}
  \end{table}
 

\subsubsection{Characterization as Economic Object}

\paragraph{Identity and Representation on the Blockchain}

Machines do not have an identity on the blockchain, but represented as IP addresses in a virtual network. A machine can have multiple wallets 

\paragraph{Interaction with the Blockchain}

The library provides an abstraction layer for blockchain interaction. 

\paragraph{Micropayments}

Two mechanisms for micropayments are implemented. Simple unidirectional payment channels as presented in Sec. \ref{sec:unipc} and off-chain payments (BitTransfer). 

\subsubsection{Business Model}

21 is positioned at the center of a possible new type of digital economy with various ways for monetization. As of now the main revenue is generated by 21 Bitcoin Computer sales. Furthermore, there is potential revenue from mining, digital services on the marketplace, and embedded mining chip sales. Embedded mining could play a more important role in the future, and the mining chips are already prepared for revenue sharing. 21 is ideally positioned to act as a large payment service provider in payment channel networks (c.f. Sec. \ref{sec:paymentchannelnetworks} and \cite{decker2015Duplex}).


\subsection{Slock.it}

\subsubsection{Portrait}
Slock.it was founded in September 2015 by long-term members of the Ethereum community. Slock.it aims to play a significant role in the sharing economy by disintermediating existing companies like Uber and AirBnB, as well as by providing \emph{sharing capabilities} to many more objects. At first this is envisioned to be enabled by a device termed the Ethereum Computer. The Ethereum Computer is intended to provide a bridge between the physical objects and smart contracts on the Ethereum blockchain.

The Team behind Slock.it furthermore implemented a set of smart contracts known as the \emph{Standard DAO Framework} and which have been deployed to the Ethereum blockchain as \emph{The DAO}. The DAO was meant as a shareholder-controlled venture fund. Everyone was able to send ether to the DAO contract in exchange for DAO tokens which provide voting rights and potential rewards. Moreover, everyone was able to send a proposal to the DAO, and token holders were able to vote on proposals. Proposals ask for ether payout under specific conditions. Slock.it wanted to fund the development of the Ethereum Computer by means of a DAO proposal, and provide DAO token holders with a share of the revenue for every trade facilitated by an Ethereum computer. THe DAO collected more than USD 130M worth of ether. However, many problems of the DAO contracts became identified which culminated in the exploitation of a re-entry bug.

\subsubsection{Technological Overview}

\begin{figure}
\centering
\includegraphics[scale=0.7]{./externalized/slockit.pdf}
\caption{High-level overview of the Slock.it architecture. }
\label{fig:21marketplace}
\end{figure}

\subsubsection{Characterization as Economic Object}

\paragraph{Identity and Representation on the Blockchain}

\paragraph{Interaction with the Blockchain}

\paragraph{Micropayments}

\subsection{ADEPT}


\section{Use Cases and Applications}

\section{Business Model Implications}






% \subsection{Asset Utilization and the Sharing Economy}

% \subsection{Extending the as-a-Service-Paradigm}

% \subsection{Lease to Own}

% \subsection{Backend-less Operations}

% \subsection{Revenue Sharing}

% \section{Other Opportunities in the Internet of Things}

% \subsection{A Black Box for the Internet of Things}

% \subsection{Enhancing Security through Decentralization}

% \subsection{Bringing the Cloud to the Edge}

% \cite{Loke:2015:MCS:2737797.2656214} show ad-hoc computations with near devices.

% \section{Challenges and Open Questions}


% \cite{Christidis2016} provide a thorough preliminaries section. In particular the sections about different consensus algorithms is interesting. The main contribution is the discussion of applications of blockchains for the Internet of Things, and their deployment considerations. Along the lines of the Device Democracy paper the authors argue that IoT devices lead to high maintenance costs for the manufacturer and give the example of the need to distribute software updates for many years. From the consumer perspective the need for IoT devices to \emph{phone home} raises privacy and security concerns.
% Software update with hash in smart contract and binary on IPFS.
% Billing layer and paves the way for a marketplace of services between devices.
% Sharing of services and property in general -> Slock.it
% Supply chain management with and without IoT.
% Deployment considerations:
% \begin{itemize}
% \item Throughput
% \item Privacy
% \item Who can mine?
% \item Legal enforceability
% \item Expected value of tokenized assets
% \item Complete autonomy is a double-edged sword
% \end{itemize}

